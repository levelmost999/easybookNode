const express = require('express')
const http = require('https')
const cheerio = require('cheerio')
import presetEnv from '../config/config'


const baseUrl = presetEnv.baseUrl
const home = express.Router()

home.get('/getRecommend',(req,res) => {
    // http.get(baseUrl,(data)=>{
    //     console.log(11);
    //     let resData = [],size =0 
    //     data.on('data',(chunk)=>{
    //         resData.push(chunk)
    //         size += chunk.length
    //     })
    //     data.on('end',()=>{
    //         const resStr = Buffer.concat(resData,size).toString()
    //         const $ = cheerio.load(resStr)
    //         $('.type .block').each((index,item)=>{
    //             console.log($(item).html(),11);
    //         })
    //         res.status(200).send($('.type').html())
    //     })
    // })
    res.status(200).send('success')
})
home.get('/test',(req,res) => {
    console.log('test', 99);
    res.status(200).send(
        {"code":200,"res":{"finalCode":{"code":"<View title=\"活动列表\" :title=\"i18n.get('活动列表').d('活动列表')\">\n    <LinkTabs>\n        <!--<LinkTab :title=\"i18n.get('促销优惠').d('促销优惠')\"\n                 action=\"sagittarius_admin_CampaignDefPagingVO_EnterpriseCampaignPagingList\"\n                 :context=\"{campaignType : 'PISCES'}\"/>-->\n        <LinkTab :title=\"i18n.get('自动化营销').d('自动化营销')\"\n                 action=\"sagittarius_admin_CampaignDefPagingVO_EnterpriseCampaignPagingList\"\n                 :context=\"{campaignType : 'AUTOMATION'}\"/>\n        <LinkTab :title=\"i18n.get('互动营销').d('互动营销')\"\n                 action=\"sagittarius_admin_CampaignDefPagingVO_interactiveCampaignPagingListAction\"/>\n    </LinkTabs>\n\n    <es_frontend_H5CardTableList\n            :statusMap=\"{'DRAFT':['rgba(7,10,26,0.30)', '草稿中'],'INIT': ['#FEAB00', '未开始'], 'ACTIVE' : ['#34B37E', '已开始'], 'END' : ['rgba(7,10,26,0.30)', '已结束']}\"\n            imageJsonKey=\"pageResource\"\n            imageKey=\"thumbnail\"\n            nameKey=\"campaignName\"\n            dataSourceAction=\"sagittarius_admin_CampaignDefPagingVO_CampaignDefEXTAction\"\n            modelKey=\"sagittarius_admin_CampaignDefPagingVO\"\n            key=\"table\" model=\"sagittarius_admin_CampaignDefPagingVO\"\n            descKey=\"campaignTime\"\n            whitelistTemplateUrl=\"https://umop-uat.saas.cmsk1979.com/api/cms/oss/file/download/scutum/cms/2022/11/22/d818fe32889e4e8c816efe764b21ec27.xlsx\"\n    @triggerViewAction=\"triggerViewAction\"\n    :dataSourceActionContext=\"{campaignType:'INTERACTIVE'}\"\n\n    >\n\n    <!-- 配置过滤筛选，字段需配合数据模型-->\n    <Search>\n        <Fields>\n            <Field name=\"id\" label=\"活动编码\"/>\n            <Field name=\"campaignName\"/>\n            <Field name=\"campaignTemplateName\"/>\n            <Field name=\"createdAt\"/>\n            <Field name=\"status\" singleInSearch=\"true\">\n                <RenderType>\n                    <Select\n                    @allowValues=\"(values) => (values.filter(item => (item !== 'PAUSE' && item !== 'DELETED')))\" />\n                </RenderType>\n\n            </Field>\n        </Fields>\n    </Search>\n\n    <!-- 配置额外action按钮(如果有serverAction请求操作，建议after配置Refresh，操作结束刷新页面数据)-->\n    <!-- action按钮没有配置layout时，会渲染在视图切换按钮的做左边-->\n    <!-- action按钮配置icon，会直接渲染nusi3.0图标库的图标-->\n    <Actions>\n        <Action type=\"Create\"\n                action=\"sagittarius_admin_CampaignDefPagingVO_interactiveCampaignDefAddDialogAction\"\n                :env=\"{operate: 'CREATE',title:'新建活动'}\"\n                openViewSize=\"l\"\n                layout=\"Header\"/>\n        <Action type=\"Create\" icon=\"nusistar\"\n        @action=\"() => {\n        triggerViewAction('sagittarius_admin_CampaignDefPagingVO_favoriteList', {\n        openViewSize: 'l',\n        openViewType: 'Dialog'\n        })\n        }\"/>\n    </Actions>\n\n    <!-- 配置表格字段，字段需配合数据模型-->\n    <Fields>\n        <Field name=\"id\" label=\"活动编码\"/>\n        <Field name=\"campaignName\" label=\"活动名称\"/>\n        <Field name=\"campaignTemplateName\" label=\"模版名称\"/>\n        <Field name=\"status\" :isStatus=\"true\"\n               :statusMap=\"{'DRAFT':['rgba(7,10,26,0.30)', '草稿中'],'INIT': ['#FEAB00', '未开始'], 'ACTIVE' : ['#34B37E', '已开始'], 'END' : ['rgba(7,10,26,0.30)', '已结束']}\"/>\n        <Field name=\"qrCode\" :isQRCode=\"true\"/>\n        <Field name=\"campaignTime\" />\n        <Field name=\"enterprise\" />\n        <Field name=\"enterpriseCity\" />\n        <Field name=\"creatorName\"/>\n        <Field name=\"createdAt\">\n            <RenderType>\n                <Number format=\"YYYY-MM-DD HH:mm:ss\"/>\n            </RenderType>\n        </Field>\n    </Fields>\n\n    <!-- 表格行操作，同时也会渲染到卡片footer的操作-->\n    <!-- action按钮配置icon和label，卡片视图页面会直接渲染nusi3.0图标库的图标和label-->\n    <RecordActions label=\"操作\">\n        <Action icon=\"nusidisplay\" label=\"查看\"\n                action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\"\n                :env=\"{id: this.record.id, disabled: true,readOnly : true,title:'活动详情'}\"/>\n        <Action nusiIcon=\"edit\" label=\"编辑\"\n                action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\"\n                :show=\"this.record.status == 'DRAFT'\"\n                :env=\"{id: this.record.id,title:'编辑活动'}\"/>\n        <Action nusiIcon=\"edit\" label=\"编辑\"\n                action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\"\n                :show=\"this.record.status == 'ACTIVE'\"\n                :env=\"{id: this.record.id, disabled: true,campaignStatus:'ACTIVE',title:'编辑活动'}\"/>\n        <Action nusiIcon=\"edit\" label=\"编辑\"\n                action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\"\n                :show=\"this.record.status == 'INIT'\"\n                :env=\"{id: this.record.id, disabled: true,campaignStatus:'INIT',title:'编辑活动'}\"/>\n        <Action label=\"明细列表\" action=\"sagittarius_admin_CampaignJoinListVO_campaignJoinList\"\n                nusiIcon=\"default-list\"\n                :show=\"this.record.status != 'DRAFT'\"\n                :env=\"{campaignId: this.record.id}\"\n        />\n        <Action label=\"删除\"\n                nusiIcon=\"delete\"\n                action=\"sagittarius_admin_CampaignDefDeleteDTO_CampaignDefAction::deleteInteractiveCampaign\"\n                :confirm=\"i18n.get('你确定要删除该活动吗？').d('你确定要删除该活动吗？')\"\n                :show=\"this.record.status != 'ACTIVE'\" after=\"Refresh\"/>\n        <Action label=\"启用\" icon=\"nusisend\" :show=\"this.record.status == 'DRAFT'\"\n                :confirm=\"i18n.get('你确定要启用该活动吗？').d('你确定要启用该活动吗？')\"\n                action=\"sagittarius_admin_InteractiveCampaignDefSubmitDTO_InteractiveCampaignDefAction::submitOrSave\"\n                after=\"Refresh\"/>\n        <Action label=\"停用\" after=\"Refresh\"\n                icon=\"nusidrop\"\n                :confirm=\"i18n.get('你确定要停用该活动吗？').d('你确定要停用该活动吗？')\"\n                :show=\"this.record.status == 'ACTIVE' || this.record.status == 'INIT'\"\n                action=\"sagittarius_admin_CampaignDefEndDTO_CampaignDefAction::end\"/>\n\n        <Action label=\"预览\"\n                icon=\"nusidisplay\"\n                :show=\"this.record.qrCode && this.record.status != 'DRAFT'\"\n                :iframeUrl=\"this.record.qrCode.indexOf('?') > -1 ? this.record.qrCode + '&campaignPreviewMode=sagittariusMock' : this.record.qrCode + '?campaignPreviewMode=sagittariusMock'\"\n                :iframeProps=\"{height: '600px', showQRCode: true, size: '64px'}\"\n        />\n\n        <Action label=\"收藏\"\n                action=\"sagittarius_admin_CampaignDefPagingVO_CampaignDefAction::addCollection\"\n                :show=\"!this.record.isCollection && this.record.status =='END'\"\n                :context=\"{record: {id: this.record.id,status:this.record.status}}\" after=\"Refresh\"/>\n\n        <Action label=\"复制\"\n                action=\"sagittarius_admin_CampaignDefPagingVO_CampaignDefAction::copyCampaign\"\n                :env=\"{id: this.record.id}\" after=\"Refresh\"/>\n\n        <Action label=\"复制活动链接\"\n                nusiIcon=\"copy\"\n                :show=\"this.record.status != 'DRAFT'\"\n        @action=\"() => copyToClipboard(this.record.qrCode)\" />\n        <Action label=\"复制可分享小程序链接\"\n                nusiIcon=\"copy\"\n                :allowShare=\"true\"\n                :show=\"this.record.status != 'DRAFT'\"\n                :wechatUrl=\"this.record.qrCode\" />\n        <Action label=\"复制不可分享小程序链接\"\n                nusiIcon=\"copy\"\n                :allowShare=\"false\"\n                :show=\"this.record.status != 'DRAFT'\"\n                :wechatUrl=\"this.record.qrCode\" />\n        <Action label=\"设置白名单\"\n                nusiIcon=\"copy\"\n                :show=\"this.record.status != 'END'\"\n                type=\"setWhiteList\"/>\n<!--        <Action label=\"活动分析\"-->\n<!--                action=\"sagittarius_admin_CampaignAnalyzeVO_campaignAnalyze\"-->\n<!--                :show=\"this.record.status == 'END' || this.record.status == 'ACTIVE'\"-->\n<!--                :env=\"{campaignAnalyseUrl: this.record.campaignAnalyseUrl,campaignId:this.record.id}\" after=\"Refresh\"/>-->\n<!--        <Action label=\"接口文档\" nusiIcon=\"default-list\"-->\n<!--                :show=\"this.record.status != 'DRAFT'\"-->\n<!--                :previewData=\"[{url: this.record.openApiAddress}]\"-->\n        />\n    </RecordActions>\n</es_frontend_H5CardTableList>\n        </View>","compiledCode":"<View title=\"活动列表\" :title=\"return i18n.get('活动列表').d('活动列表')\">\n    <LinkTabs>\n        \n        <LinkTab :title=\"return i18n.get('自动化营销').d('自动化营销')\" action=\"sagittarius_admin_CampaignDefPagingVO_EnterpriseCampaignPagingList\" :context=\"return { campaignType: 'AUTOMATION' }\"/>\n        <LinkTab :title=\"return i18n.get('互动营销').d('互动营销')\" action=\"sagittarius_admin_CampaignDefPagingVO_interactiveCampaignPagingListAction\"/>\n    </LinkTabs>\n\n    <es_frontend_H5CardTableList :statusMap=\"return { 'DRAFT': ['rgba(7,10,26,0.30)', '草稿中'], 'INIT': ['#FEAB00', '未开始'], 'ACTIVE': ['#34B37E', '已开始'], 'END': ['rgba(7,10,26,0.30)', '已结束'] }\" imageJsonKey=\"pageResource\" imageKey=\"thumbnail\" nameKey=\"campaignName\" dataSourceAction=\"sagittarius_admin_CampaignDefPagingVO_CampaignDefEXTAction\" modelKey=\"sagittarius_admin_CampaignDefPagingVO\" key=\"table\" model=\"sagittarius_admin_CampaignDefPagingVO\" descKey=\"campaignTime\" whitelistTemplateUrl=\"https://umop-uat.saas.cmsk1979.com/api/cms/oss/file/download/scutum/cms/2022/11/22/d818fe32889e4e8c816efe764b21ec27.xlsx\" @triggerViewAction=\"triggerViewAction\" :dataSourceActionContext=\"return { campaignType: 'INTERACTIVE' }\"\n\n    >\n\n    \n    <Search>\n        <Fields>\n            <Field name=\"id\" label=\"活动编码\"/>\n            <Field name=\"campaignName\"/>\n            <Field name=\"campaignTemplateName\"/>\n            <Field name=\"createdAt\"/>\n            <Field name=\"status\" singleInSearch=\"true\">\n                <RenderType>\n                    <Select @allowValues=\"function (values) { return (values.filter(function (item) { return (item !== 'PAUSE' && item !== 'DELETED'); })); }\" />\n                </RenderType>\n\n            </Field>\n        </Fields>\n    </Search>\n\n    \n    \n    \n    <Actions>\n        <Action type=\"Create\" action=\"sagittarius_admin_CampaignDefPagingVO_interactiveCampaignDefAddDialogAction\" :env=\"return { operate: 'CREATE', title: '新建活动' }\" openViewSize=\"l\" layout=\"Header\"/>\n        <Action type=\"Create\" icon=\"nusistar\" @action=\"function () {    triggerViewAction('sagittarius_admin_CampaignDefPagingVO_favoriteList', {        openViewSize: 'l',        openViewType: 'Dialog'    });}\"/>\n    </Actions>\n\n    \n    <Fields>\n        <Field name=\"id\" label=\"活动编码\"/>\n        <Field name=\"campaignName\" label=\"活动名称\"/>\n        <Field name=\"campaignTemplateName\" label=\"模版名称\"/>\n        <Field name=\"status\" :isStatus=\"return true\" :statusMap=\"return { 'DRAFT': ['rgba(7,10,26,0.30)', '草稿中'], 'INIT': ['#FEAB00', '未开始'], 'ACTIVE': ['#34B37E', '已开始'], 'END': ['rgba(7,10,26,0.30)', '已结束'] }\"/>\n        <Field name=\"qrCode\" :isQRCode=\"return true\"/>\n        <Field name=\"campaignTime\" />\n        <Field name=\"enterprise\" />\n        <Field name=\"enterpriseCity\" />\n        <Field name=\"creatorName\"/>\n        <Field name=\"createdAt\">\n            <RenderType>\n                <Number format=\"YYYY-MM-DD HH:mm:ss\"/>\n            </RenderType>\n        </Field>\n    </Fields>\n\n    \n    \n    <RecordActions label=\"操作\">\n        <Action icon=\"nusidisplay\" label=\"查看\" action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\" :env=\"return { id: this.record.id, disabled: true, readOnly: true, title: '活动详情' }\"/>\n        <Action nusiIcon=\"edit\" label=\"编辑\" action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\" :show=\"return this.record.status == 'DRAFT'\" :env=\"return { id: this.record.id, title: '编辑活动' }\"/>\n        <Action nusiIcon=\"edit\" label=\"编辑\" action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\" :show=\"return this.record.status == 'ACTIVE'\" :env=\"return { id: this.record.id, disabled: true, campaignStatus: 'ACTIVE', title: '编辑活动' }\"/>\n        <Action nusiIcon=\"edit\" label=\"编辑\" action=\"sagittarius_admin_CampaignDefNodeDetailVO_interactiveCampaignDefDetailAction\" :show=\"return this.record.status == 'INIT'\" :env=\"return { id: this.record.id, disabled: true, campaignStatus: 'INIT', title: '编辑活动' }\"/>\n        <Action label=\"明细列表\" action=\"sagittarius_admin_CampaignJoinListVO_campaignJoinList\" nusiIcon=\"default-list\" :show=\"return this.record.status != 'DRAFT'\" :env=\"return { campaignId: this.record.id }\"\n        />\n        <Action label=\"删除\" nusiIcon=\"delete\" action=\"sagittarius_admin_CampaignDefDeleteDTO_CampaignDefAction::deleteInteractiveCampaign\" :confirm=\"return i18n.get('你确定要删除该活动吗？').d('你确定要删除该活动吗？')\" :show=\"return this.record.status != 'ACTIVE'\" after=\"Refresh\"/>\n        <Action label=\"启用\" icon=\"nusisend\" :show=\"return this.record.status == 'DRAFT'\" :confirm=\"return i18n.get('你确定要启用该活动吗？').d('你确定要启用该活动吗？')\" action=\"sagittarius_admin_InteractiveCampaignDefSubmitDTO_InteractiveCampaignDefAction::submitOrSave\" after=\"Refresh\"/>\n        <Action label=\"停用\" after=\"Refresh\" icon=\"nusidrop\" :confirm=\"return i18n.get('你确定要停用该活动吗？').d('你确定要停用该活动吗？')\" :show=\"return this.record.status == 'ACTIVE' || this.record.status == 'INIT'\" action=\"sagittarius_admin_CampaignDefEndDTO_CampaignDefAction::end\"/>\n\n        <Action label=\"预览\" icon=\"nusidisplay\" :show=\"return this.record.qrCode && this.record.status != 'DRAFT'\" :iframeUrl=\"return this.record.qrCode.indexOf('?') > -1 ? this.record.qrCode + '&campaignPreviewMode=sagittariusMock' : this.record.qrCode + '?campaignPreviewMode=sagittariusMock'\" :iframeProps=\"return { height: '600px', showQRCode: true, size: '64px' }\"\n        />\n\n        <Action label=\"收藏\" action=\"sagittarius_admin_CampaignDefPagingVO_CampaignDefAction::addCollection\" :show=\"return !this.record.isCollection && this.record.status == 'END'\" :context=\"return { record: { id: this.record.id, status: this.record.status } }\" after=\"Refresh\"/>\n\n        <Action label=\"复制\" action=\"sagittarius_admin_CampaignDefPagingVO_CampaignDefAction::copyCampaign\" :env=\"return { id: this.record.id }\" after=\"Refresh\"/>\n\n        <Action label=\"复制活动链接\" nusiIcon=\"copy\" :show=\"return this.record.status != 'DRAFT'\" @action=\"function () { return copyToClipboard(this.record.qrCode); }\" />\n        <Action label=\"复制可分享小程序链接\" nusiIcon=\"copy\" :allowShare=\"return true\" :show=\"return this.record.status != 'DRAFT'\" :wechatUrl=\"return this.record.qrCode\" />\n        <Action label=\"复制不可分享小程序链接\" nusiIcon=\"copy\" :allowShare=\"return false\" :show=\"return this.record.status != 'DRAFT'\" :wechatUrl=\"return this.record.qrCode\" />\n        <Action label=\"设置白名单\" nusiIcon=\"copy\" :show=\"return this.record.status != 'END'\" type=\"setWhiteList\"/>\n\n\n\n\n\n\n\n        />\n    </RecordActions>\n</es_frontend_H5CardTableList>\n        </View>\n","compiledControllerCode":"var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\ndefine([\"require\", \"exports\", \"nusi-sdk\"], function (require, exports, nusi_sdk_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var default_1 = /** @class */ (function (_super) {\n        __extends(default_1, _super);\n        function default_1() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.copyToClipboard = function (value) {\n                if (!value) {\n                    nusi_sdk_1.showMessage({\n                        type: 'Error',\n                        message: _this.i18n.get('没有H5模版资源，无法复制').d('没有H5模版资源，无法复制')\n                    });\n                    return;\n                }\n                var input = document.createElement('textarea');\n                document.body.appendChild(input);\n                input.innerHTML = value.replace(/\\n/g, '&#13;');\n                input.select();\n                if (document.execCommand) {\n                    document.execCommand('copy');\n                    nusi_sdk_1.showMessage({ type: \"Success\", message: '已复制到剪贴板' });\n                }\n                document.body.removeChild(input);\n            };\n            return _this;\n        }\n        __decorate([\n            nusi_sdk_1.action\n        ], default_1.prototype, \"copyToClipboard\", void 0);\n        return default_1;\n    }(nusi_sdk_1.Controller));\n    exports.default = default_1;\n});\n\n","compiledControllerHash":"1fdad7d672d47f97a4e04b7c605426ea","controllerCode":"import {action, Controller, showMessage} from \"nusi-sdk\";\n\nexport default class extends Controller {\n\n    @action\n    public copyToClipboard = (value: string) => {\n        if(!value) {\n            showMessage({\n                type: 'Error',\n                message: this.i18n.get('没有H5模版资源，无法复制').d('没有H5模版资源，无法复制')\n            })\n            return\n        }\n        const input = document.createElement('textarea')\n        document.body.appendChild(input)\n        input.innerHTML = value.replace(/\\n/g, '&#13;')\n        input.select()\n        if (document.execCommand) {\n            document.execCommand('copy')\n            showMessage({type: \"Success\", message: '已复制到剪贴板'})\n        }\n        document.body.removeChild(input)\n    }\n}\n"},"isDefault":false,"key":"sagittarius_admin_CampaignDefPagingVO_interactiveCampaignDefPagingList","modelKey":"sagittarius_admin_CampaignDefPagingVO","moduleKey":"es_marketing_admin","name":"互动营销活动投放列表","type":"List"},"success":true}
    )
})

module.exports = home